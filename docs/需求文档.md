# 图片处理管理工具 - 需求分析文档

## 1. 项目概述

### 1.1 项目名称
图片处理管理工具（Pixel Porter）

### 1.2 项目背景
随着数字摄影设备的普及，用户积累了大量的图片文件。这些图片文件往往存在以下问题：
- 文件名混乱，缺乏统一规范
- 难以根据拍摄时间快速定位和管理图片
- 缺少拍摄信息的可视化展示

### 1.3 项目目标
开发一个图片处理管理工具，帮助用户批量整理图片文件，并通过水印技术为图片添加拍摄信息，提升图片管理的效率和便利性。

## 2. 用户角色与场景

### 2.1 目标用户
- 摄影爱好者
- 需要管理大量照片的普通用户
- 需要对图片进行批量处理的专业用户

### 2.2 典型使用场景
**场景一：批量整理照片**
- 用户从相机或手机导出大量照片，文件名都是自动生成的（如 IMG_001.jpg, DSC_1234.jpg）
- 用户希望根据拍摄时间重新命名这些照片，便于按时间顺序查找和管理

**场景二：创建带水印的照片版本**
- 用户希望为照片添加拍摄信息水印（如拍摄时间、相机型号、光圈、快门速度等）
- 用于分享到社交媒体或打印时保留拍摄信息

**场景三：多种命名规则切换**
- 用户可能在不同的场景下需要不同的命名规则
- 有时需要按拍摄时间命名，有时需要保留原文件名，有时需要结合两者

**场景四：EXIF信息复制与修正**
- 用户对某张图片进行了后期处理（如PS、Lightroom等），处理后图片的EXIF信息丢失
- 用户希望将原图（图片B）的EXIF信息复制到处理后的图片（图片A）上，保留拍摄参数信息
- 或者用户有多张同一场景的照片，希望统一它们的EXIF信息

## 3. 功能需求

### 3.1 功能一：批量修改图片文件名称

#### 3.1.1 功能概述
支持批量修改图片文件名，可根据用户选择的规则进行重命名。

#### 3.1.2 功能详述

**F1.1 文件选择**
- 支持选择单个或多个图片文件
- 支持选择整个文件夹进行批量处理
- 支持常见图片格式（JPG、JPEG、PNG、RAW等）
- 支持递归处理子文件夹中的图片（可选）

**F1.2 命名规则选择**
用户可以选择以下命名规则之一或组合：

1. **基于EXIF拍摄时间**
   - 从图片EXIF信息中提取拍摄时间（DateTimeOriginal）
   - 格式：YYYYMMDD_HHMMSS 或用户自定义格式
   - 示例：20240115_143022.jpg
   - 如果图片没有拍摄时间EXIF信息，应提供备选处理方案（使用文件创建时间或保留原文件名）

2. **基于文件创建时间**
   - 使用操作系统的文件创建时间（File Creation Time）
   - 格式：YYYYMMDD_HHMMSS 或用户自定义格式
   - 示例：20240115_143022.jpg

3. **基于原始文件名**
   - 保留原始文件名
   - 可选项：去除前缀、后缀或统一添加前缀/后缀
   - 示例：原文件 IMG_001.jpg → IMG_001.jpg 或 Photo_IMG_001.jpg

4. **组合命名规则**
   - 支持组合多种规则
   - 示例：拍摄时间_原始文件名 → 20240115_143022_IMG_001.jpg
   - 示例：原始文件名_拍摄时间 → IMG_001_20240115_143022.jpg

**F1.3 文件名格式化选项**
- 日期时间格式自定义（YYYY/YY/MM/DD、HH/mm/ss等）
- 文件名分隔符自定义（下划线、横线、空格等）
- 序号填充（如果多个文件在同一秒拍摄，自动添加序号）
- 文件名长度限制设置

**F1.4 重命名预览**
- 在执行重命名操作前，显示重命名前后文件名对比
- 支持用户确认或取消操作
- 对于可能产生的文件名冲突，提供警告和解决方案

**F1.5 冲突处理**
- 检测重命名后可能产生的文件名冲突
- 提供冲突解决策略：
  - 自动添加序号（如：20240115_143022_001.jpg）
  - 跳过冲突文件并记录
  - 用户手动处理

**F1.6 备份选项**
- 提供重命名前备份原文件的选项
- 备份位置可选择（原目录、指定备份目录）

**F1.7 处理结果反馈**
- 显示处理进度
- 处理完成后显示统计信息：
  - 成功重命名的文件数量
  - 失败的文件数量及原因
  - 跳过的文件数量及原因

### 3.2 功能二：根据EXIF信息创建水印版本图片

#### 3.2.1 功能概述
根据图片的EXIF信息，生成带有拍摄信息水印的新版本图片。

#### 3.2.2 功能详述

**F2.1 EXIF信息提取**
从图片EXIF中提取以下信息（如果存在）：
- 拍摄时间（DateTimeOriginal）
- 相机品牌（Make）
- 相机型号（Model）
- 光圈值（FNumber）
- 快门速度（ExposureTime）
- ISO感光度（ISO）
- 焦距（FocalLength）
- 曝光模式（ExposureMode）
- 白平衡（WhiteBalance）
- GPS位置信息（可选）

**F2.2 水印内容配置**
用户可以选择在水印中显示的信息项：
- 必选项：拍摄时间（至少显示日期）
- 可选项：相机型号、光圈、快门、ISO、焦距等
- 自定义文本内容

**F2.3 水印样式配置**
- **位置选项**：
  - 左上角、左下角、右上角、右下角
  - 自定义位置（坐标设置）
- **字体设置**：
  - 字体类型选择
  - 字体大小设置
  - 字体颜色设置
- **背景设置**：
  - 无背景、半透明背景、实心背景
  - 背景颜色设置
  - 背景透明度设置
- **布局设置**：
  - 单行显示、多行显示
  - 对齐方式（左对齐、居中、右对齐）

**F2.4 水印预览**
- 在处理前提供水印效果预览
- 支持调整参数后实时预览
- 支持批量预览多个图片的水印效果

**F2.5 输出设置**
- **输出格式**：
  - 保持原格式、转换为JPG/PNG等指定格式
- **输出质量**：
  - JPG质量设置（1-100）
  - PNG压缩级别设置
- **输出位置**：
  - 原目录（覆盖原文件）
  - 原目录（新文件名，如：原文件名_watermark.jpg）
  - 指定输出目录
- **文件名规则**：
  - 自动添加后缀（如：_watermark）
  - 自定义命名规则

**F2.6 批量处理**
- 支持批量处理多个图片文件
- 支持选择文件夹进行批量处理
- 支持递归处理子文件夹（可选）
- 显示批量处理进度

**F2.7 处理结果反馈**
- 显示处理进度
- 处理完成后显示统计信息：
  - 成功添加水印的图片数量
  - 失败的图片数量及原因（如：无EXIF信息、文件损坏等）
  - 跳过的图片数量及原因

**F2.8 原图保护**
- 默认不覆盖原图，生成新文件
- 如选择覆盖原图，需用户明确确认

### 3.3 功能三：EXIF信息复制与修改

#### 3.3.1 功能概述
支持选择两张图片，读取源图片（图片B）的EXIF信息，并将这些信息复制或修改到目标图片（图片A）的EXIF中。

#### 3.3.2 功能详述

**F3.1 图片选择**
- 支持选择两张图片文件：
  - 图片A（目标图片）：需要被修改EXIF信息的图片
  - 图片B（源图片）：提供EXIF信息的参考图片
- 支持常见图片格式（JPG、JPEG、PNG、RAW、TIFF等）
- 支持通过拖拽或文件浏览器选择图片

**F3.2 EXIF信息读取与显示**
从图片B（源图片）中读取并显示以下EXIF信息（如果存在）：
- 拍摄时间（DateTimeOriginal、DateTimeDigitized）
- 相机品牌（Make）
- 相机型号（Model）
- 光圈值（FNumber）
- 快门速度（ExposureTime）
- ISO感光度（ISO）
- 焦距（FocalLength）
- 曝光模式（ExposureMode）
- 白平衡（WhiteBalance）
- 闪光灯模式（Flash）
- 测光模式（MeteringMode）
- GPS位置信息（GPSLatitude、GPSLongitude、GPSAltitude等）
- 其他EXIF标签信息

**F3.3 EXIF信息选择**
用户可以选择要复制到图片A的EXIF信息项：
- **全部复制**：复制图片B的所有EXIF信息到图片A
- **部分复制**：用户可选择需要复制的EXIF字段
  - 基本拍摄信息（拍摄时间、相机品牌、型号等）
  - 拍摄参数（光圈、快门、ISO、焦距等）
  - 位置信息（GPS坐标等）
  - 其他自定义字段
- **选择性覆盖**：对于图片A已存在的EXIF信息，用户可选择：
  - 覆盖：用图片B的信息替换图片A的信息
  - 保留：保留图片A的原有信息
  - 合并：如果图片A缺少某些字段，则从图片B复制

**F3.4 EXIF信息预览**
- 在执行修改前，显示：
  - 图片A的当前EXIF信息
  - 图片B的EXIF信息
  - 修改后将应用到图片A的EXIF信息（对比显示）
- 用户可确认或取消操作

**F3.5 批量处理支持**
- 支持选择一张源图片（图片B）和多个目标图片（图片A1、A2、A3...）
- 将图片B的EXIF信息批量复制到多个目标图片中
- 支持选择文件夹进行批量处理
- 显示批量处理进度

**F3.6 处理选项**
- **输出方式**：
  - 覆盖原文件：直接修改图片A的EXIF信息（需用户确认）
  - 生成新文件：保持原文件不变，生成带有新EXIF信息的新文件
    - 新文件名规则：原文件名_exif.jpg 或用户自定义规则
- **备份选项**：
  - 在执行覆盖操作前，提供备份原文件的选项
  - 备份位置可选择（原目录、指定备份目录）

**F3.7 兼容性处理**
- 如果图片A的格式不支持EXIF写入（如某些PNG格式），提供提示和转换建议
- 如果图片B缺少某些EXIF信息，应在预览中明确标识
- 对于不兼容的EXIF字段，提供警告信息

**F3.8 处理结果反馈**
- 显示处理进度
- 处理完成后显示统计信息：
  - 成功修改EXIF信息的图片数量
  - 失败的图片数量及原因（如：格式不支持、文件损坏、权限问题等）
  - 部分成功的图片数量及详细说明（如：某些字段无法写入）

**F3.9 原图保护**
- 默认不覆盖原图，生成新文件
- 如选择覆盖原图，需用户明确确认
- 提供操作撤销机制（如可能）

## 4. 非功能需求

### 4.1 性能需求
- 批量处理大量图片时，应保持良好的响应速度
- 单张图片处理时间应在合理范围内（建议3秒以内）
- 支持大文件处理（RAW格式、高分辨率图片）

### 4.2 兼容性需求
- 支持主流的图片格式（JPG、JPEG、PNG、RAW、TIFF等）
- 支持不同相机品牌生成的EXIF信息
- 兼容主流操作系统

### 4.3 易用性需求
- 界面简洁直观，操作流程清晰
- 提供操作提示和帮助信息
- 错误信息清晰明确，便于用户理解和处理

### 4.4 可靠性需求
- 处理失败时不影响原文件
- 提供操作撤销功能（如可能）
- 异常情况下保证数据安全

### 4.5 可扩展性需求
- 预留扩展接口，便于未来添加新功能
- 支持自定义命名规则模板的保存和复用
- 支持自定义水印模板的保存和复用

## 5. 约束条件

### 5.1 技术约束
- 需要能够读取和处理EXIF信息
- 需要支持图片编辑和生成
- 需要处理可能缺失或不完整的EXIF信息

### 5.2 业务约束
- 修改EXIF信息需要用户明确确认
- 水印处理不应过度影响原图视觉效果
- 处理大量文件时需要考虑磁盘空间
- EXIF信息修改应遵循EXIF标准规范，确保兼容性

## 6. 功能优先级

### 6.1 高优先级（MVP功能）
1. 基于EXIF拍摄时间的文件重命名
2. 基于文件创建时间的文件重命名
3. 简单的EXIF水印添加（固定位置、固定样式）
4. 批量处理支持
5. 基本的EXIF信息复制功能（两张图片之间的EXIF复制）

### 6.2 中优先级
1. 组合命名规则
2. 水印样式自定义
3. 文件名冲突处理
4. 处理预览功能
5. EXIF信息选择性复制（部分字段选择）
6. EXIF信息批量复制（一对多）

### 6.3 低优先级（增强功能）
1. 文件夹递归处理
2. 水印模板保存和复用
3. 命名规则模板保存和复用
4. GPS信息显示

## 7. 风险与假设

### 7.1 风险
1. **EXIF信息缺失或不完整**：部分图片可能没有EXIF信息，需要提供合理的备选方案
2. **文件名冲突**：批量重命名可能产生文件名冲突
3. **性能问题**：处理大量或超大图片时可能影响性能
4. **格式兼容性**：不同格式的图片EXIF信息结构可能不同，某些格式可能不支持EXIF写入
5. **EXIF写入失败**：某些图片格式或受保护的图片可能无法写入EXIF信息
6. **EXIF标准兼容性**：不同设备生成的EXIF信息可能存在兼容性问题

### 7.2 假设
1. 用户提供的图片文件可正常读取
2. 用户有足够的磁盘空间存储处理后的文件
3. 用户对EXIF信息有一定了解，能够理解相关选项的含义

## 8. 验收标准

### 8.1 文件重命名功能验收标准
- 能够正确提取EXIF拍摄时间信息
- 能够按照用户选择的规则成功重命名文件
- 能够正确处理文件名冲突
- 处理结果准确率达到100%

### 8.2 水印功能验收标准
- 能够正确提取并显示EXIF信息
- 水印位置、样式符合用户配置
- 生成的水印图片质量达到可接受水平
- 原图文件完整性得到保护

### 8.3 EXIF信息复制功能验收标准
- 能够正确读取源图片（图片B）的EXIF信息
- 能够正确将选择的EXIF信息写入目标图片（图片A）
- 支持用户选择要复制的EXIF字段
- 修改后的EXIF信息可以被其他软件正确读取和识别
- 原图文件完整性得到保护（如选择生成新文件）
- 批量处理时，所有目标图片的EXIF信息修改准确率达到100%

---

**文档版本**：v1.1  
**创建日期**：2026年1月9日
**最后更新**：2026年1月9日